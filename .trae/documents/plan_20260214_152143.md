# Fix Vercel Build Error

The Vercel build failed with `Error: Missing Supabase environment variables`. This error originates from `lib/supabase.ts`, which throws an error if `NEXT_PUBLIC_SUPABASE_URL` or `NEXT_PUBLIC_SUPABASE_ANON_KEY` are missing.

Even though you may have added these to Vercel, Next.js tries to statically generate pages (prerender) during build time. If the environment variables aren't available to the build process, or if the code executes in a context where they are undefined, the build fails.

## Solution

I will modify `lib/supabase.ts` to prevent the build from crashing when environment variables are missing during the build phase. This is a common pattern to support static generation.

## Implementation Steps

1.  **Modify `lib/supabase.ts`**:
    *   Change the strict error throw to a conditional check.
    *   If environment variables are missing, log a warning instead of throwing, or provide a dummy client/fallback if possible, but the safest way for the build to pass is to simply not throw **during build time** or handle the `undefined` case gracefully.
    *   Since `createClient` requires valid URLs, I'll update the logic to:
        *   Check if we are in a browser environment or build environment.
        *   If vars are missing, perhaps return `null` or a mocked client, OR better yet, **remove the throw** and let `createClient` fail only when actually used at runtime, or ensure the check only happens when the client is invoked.
    *   However, `createClient` is called at the top level. I will wrap the initialization or relax the check.

    *   **Better Approach**: Provide empty strings as fallbacks if missing, to allow the `createClient` to initialize (it might fail at runtime if used, but build will pass). Or, only throw if we are NOT in a build phase (though detecting "build phase" reliably can be tricky).

    *   **Proposed Fix**:
        ```typescript
        const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || ''
        const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || ''

        // Only throw if we are actually trying to use it and they are empty?
        // Actually, createClient throws if url is empty.
        ```

    *   **Best Fix**: Use a conditional export or a getter function, OR simply remove the `throw` and let the developer ensure env vars are set. But since this is a build error during prerendering, it means the page `/` is trying to fetch data.
    *   The error stack trace shows `Error occurred prerendering page "/"`. This implies `app/page.tsx` (or a component it imports, likely `RecyclingApp` which imports `supabase`) is executing code that uses `supabase` immediately.
    *   I will modify `lib/supabase.ts` to allow empty values during build, or better, instruct you to ensure the Environment Variables are correctly set in Vercel **Project Settings** -> **Environment Variables**.

    *   **Wait**, you likely *did* set them, but maybe forgot to check the boxes for "Production", "Preview", AND "Development"? Or maybe the names are slightly off?
    *   The error message `Error: Missing Supabase environment variables` explicitly comes from **line 7** of `lib/supabase.ts`.

    *   **Action**: I will modify `lib/supabase.ts` to suppress this error during the build process if possible, or advise you to double-check Vercel settings. But to fix the code: I will remove the hard `throw` and handle the missing keys more gracefully, perhaps by returning a dummy client or just `undefined` (and handling that usage site).
    *   Actually, returning a dummy client is safer for the build.

2.  **Verify Vercel Config (User Action)**:
    *   I cannot check your Vercel dashboard. You must ensure `NEXT_PUBLIC_SUPABASE_URL` and `NEXT_PUBLIC_SUPABASE_ANON_KEY` are added in Vercel.

3.  **Code Change**:
    *   Update `lib/supabase.ts` to not throw.

## Revised Code for `lib/supabase.ts`
```typescript
import { createClient } from '@supabase/supabase-js'

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || 'https://placeholder.supabase.co'
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || 'placeholder'

export const supabase = createClient(supabaseUrl, supabaseAnonKey)
```
*   This is a "hack" to let the build pass if the vars are missing (e.g. during CI checks where no secrets are present).
*   However, if the page *actually* tries to fetch data during build (SSG), it will fail with a network error instead of this config error.
*   The error trace says `Error: Missing Supabase environment variables`, which is my custom error.
*   I will soft-fail this check.

## Plan
1.  Modify `lib/supabase.ts` to use fallback values if env vars are missing, preventing the immediate crash.
2.  Explain that you need to verify Vercel Environment Variables.